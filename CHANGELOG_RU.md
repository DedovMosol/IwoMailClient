# История изменений


## v1.0.7 (27.12.2025)

### Новые функции
- **Диалог несовпадения email** — при верификации Exchange аккаунта показывается информативный диалог вместо ошибки
- **Цветовые темы** — выбор из 7 цветовых тем: фиолетовая, синяя, красная, жёлтая, оранжевая, зелёная, розовая
- **Темы по дням недели** — возможность назначить разные цвета для каждого дня недели
- **Анимированный логотип** — конвертик в секции "О приложении" с пульсацией и покачиванием
- **Группировка настроек** — настройки разделены на секции: Внешний вид, Синхронизация, О приложении
- **Подпись для аккаунта** — возможность задать подпись для каждого аккаунта, автоматически подставляется при написании письма
- **Звуки отправки и получения** — звуковое уведомление при отправке письма и получении новых писем

### Улучшения интерфейса
- **Исправлен перенос слов** — в диалоге доната слова больше не разрываются по буквам при большом шрифте
- **Обновлены советы** — секция "Полезно знать" сокращена до 4 ключевых пунктов
- **Pull-to-refresh с конвертиком** — потяните список писем вниз для обновления, анимированный конвертик вместо стандартного индикатора
- **Предпросмотр вложений** — если письмо содержит скачанную картинку, миниатюра показывается в списке писем

### Исправления
- **Исправлен адрес отправителя в MDN/DSN** — отчёты о прочтении и доставке теперь отправляются на правильный email
- **Исправлены поля ввода времени** — в диалоге планирования отправки теперь можно нормально редактировать часы/минуты/секунды
- **Автоактивация нового аккаунта** — при добавлении второго аккаунта он автоматически становится активным
- **Сохранение настроек при ошибке 401** — при ошибке авторизации сохраняются email, сервер, цвет, галочка сертификатов; сбрасываются только домен, логин и пароль
- **Пользовательские сертификаты** — приложение теперь доверяет сертификатам, установленным в настройках Android

### Технические улучшения
- **LocalColorTheme** — CompositionLocal для динамической смены цветовой темы
- **Градиенты TopAppBar и FAB** — теперь используют цвета из выбранной темы

### Безопасность
- **Отключён ADB бэкап** — `allowBackup="false"` предотвращает извлечение данных приложения через ADB 

---

## v1.0.6c (26.12.2025)

### Новые функции
- **Верификация email при добавлении Exchange аккаунта** — проверка что введённый email соответствует реальному email на сервере
- **Экран "Проверка учётной записи"** — анимированный экран верификации как в Outlook
- **Запрос отчёта о прочтении (MDN)** — чекбокс при отправке письма для запроса уведомления о прочтении
- **Запрос отчёта о доставке (DSN)** — чекбокс для подтверждения доставки письма на сервер получателя
- **Настройка размера шрифта** — выбор маленький/средний/большой в настройках приложения
- **Индивидуальные настройки синхронизации** — каждый аккаунт имеет свой режим и интервал
- **Настройки в карточке аккаунта** — режим (Push/Scheduled) и интервал прямо в UI

### Оптимизация батареи
- **Выбор режима синхронизации** — для Exchange аккаунтов можно выбрать Push (мгновенные уведомления) или По расписанию (экономия батареи)
- **Ночной режим экономии** — с 23:00 до 7:00 синхронизация каждые 60 минут вместо настроенного интервала
- **Адаптивный heartbeat** — автоматическое увеличение интервала Ping с 5 до 15 минут при стабильной работе
- **Умная остановка без сети** — PushService приостанавливается когда нет интернета, не тратит батарею
- **Debounce синхронизации** — защита от двойных запросов синхронизации
- **Умная логика синхронизации** — автоотключение периодической синхронизации для Push аккаунтов

### Исправления багов
- **Исправлена вибрация** — при выделении писем вибрация работает корректно
- **Исправлена подсветка в поиске** — подсветка найденных букв работает на всех устройствах
- **Исправлен скролл при "Выбрать всё"** — автоматическая прокрутка к началу списка
- **Исправлены уведомления** — фиксированные ID, не создают спам
- **Исправлен язык по умолчанию** — теперь русский для новых установок

### Технические улучшения
- **VerificationScreen** — новый экран верификации email с анимацией
- **fetchOneEmailForVerification** — метод получения 1 письма для быстрой верификации (WindowSize=1)
- **NetworkCallback** — мгновенное возобновление работы при появлении сети
- **База данных v9** — добавлено поле syncIntervalMinutes в AccountEntity
- **SyncWorker.getMinSyncInterval()** — централизованная функция получения интервала
- **SyncMode.getDisplayName()** — локализация режимов синхронизации
- **ScaledAlertDialog** — все диалоги теперь корректно масштабируют шрифт согласно настройкам
- **Очистка кода** — удалены неиспользуемые методы из SettingsRepository

---

## v1.0.5c (25.12.2025)

### Исправления уведомлений
- Исправлены уведомления на заблокированном экране — добавлен `VISIBILITY_PUBLIC`
- Каналы уведомлений теперь пересоздаются при запуске для применения новых настроек
- Добавлена категория `CATEGORY_EMAIL` для правильной обработки системой
- Канал новых писем теперь имеет `lockscreenVisibility = PUBLIC`

### Исправления перемещения писем
- Исправлен баг восстановления из корзины — теперь письмо возвращается в папку, из которой было удалено
- `originalFolderId` корректно обновляется при перемещении между папками

### Исправления навигации
- Исправлен баг открытия письма из уведомления после смахивания приложения
- Добавлена проверка существования письма перед открытием
- Если письмо не найдено — открываются Входящие с фильтром "Непрочитанные"

### Улучшения совместимости
- Улучшена совместимость TLS на разных устройствах — убран устаревший SSLv3
- Добавлена поддержка TLSv1.3
- Улучшена обработка ошибок SSL/TLS — fallback на дефолты OkHttp
- Добавлены таймауты на синхронизацию (60 сек общий, 30 сек на папку)

### Исправления навигации
- Исправлен баг открытия письма из уведомления после смахивания приложения
- Добавлена проверка существования письма перед открытием
- Если письмо не найдено — открываются Входящие с фильтром "Непрочитанные"

---

## v1.0.5b (25.12.2025)

### Модернизация интерфейса
- Градиентные TopAppBar на всех экранах (фиолетово-синий градиент)
- Карточки папок в едином стиле с яркими градиентами
- Gmail-style цвета аватаров для отправителей писем
- Пульсирующая анимация кнопки "Поддержать разработчика"
- Тактильная обратная связь (вибрация) при выделении писем
- Добавлена секция "Советы" с информацией о бета-функциях
- Функция очистки корзины с диалогом подтверждения

### Улучшения синхронизации
- Улучшена надёжность фоновой синхронизации (AlarmManager fallback)
- SyncAlarmReceiver теперь синхронизирует напрямую, не полагаясь только на WorkManager
- Foreground notification автоматически переводится при смене языка

### Исправления
- Исправлен баг с ложным переходом на экран настройки при запуске
- Улучшена логика автосинхронизации при старте приложения
- При открытии письма из уведомления кнопка "назад" ведёт во Входящие
- Состояние раскрытых секций сохраняется при синхронизации

---

## v1.0.4b (25.12.2025)

### Оптимизация производительности и памяти
- SettingsRepository теперь singleton — устранено создание множества экземпляров
- EasClient кэшируется для каждого аккаунта — экономия ресурсов при повторных запросах
- Исправлена утечка памяти в SyncAlarmReceiver — локальный coroutine scope с cancel() в finally
- Убрано дублирование синхронизации когда Direct Push не поддерживается сервером
- Убраны все Log.d() вызовы для production сборки — уменьшен размер APK
- Оптимизированы ProGuard правила для R8 минификации

### Улучшения интерфейса
- Улучшена логика диалога "Переместить": из системных папок показываются только пользовательские, из пользовательских — все папки
- Исправлен краш при открытии письма из уведомления на заблокированном экране
- IMAP и POP3 помечены как "beta" в интерфейсе добавления аккаунта

---

## v1.0.3c (24.12.2025)

### Критические исправления
- Исправлена критическая проблема с уведомлениями — теперь уведомления приходят для всех новых писем
- Исправлена навигация из foreground notification — теперь открывает главный экран
- Улучшена логика определения новых писем — используется время последней проверки
- Добавлен SyncAlarmReceiver для надёжной синхронизации на Xiaomi/MIUI

---

## v1.0.3b (24.12.2025)

### Улучшения уведомлений
- Улучшены уведомления о новых письмах — теперь показывают отправителя и тему
- При клике на уведомление с одним письмом — открывается это письмо напрямую
- Добавлена локализация специальных папок Exchange (Tasks, Calendar, Contacts)
- Добавлен запрос разрешений при первом запуске (батарея, точные alarm'ы)
- Улучшена надёжность фоновой синхронизации на Xiaomi/MIUI (AlarmManager fallback)
- Foreground notification теперь локализуется по настройкам приложения

---

## v1.0.3a (23.12.2025)

### Локализация
- Исправлена локализация интерфейса — все строки корректно переводятся
- Исправлены захардкоженные русские строки в ComposeScreen, SearchScreen, EmailListScreen
- Названия системных папок теперь локализуются (Inbox/Входящие, Sent/Отправленные и т.д.)
- Исправлен краш при первом добавлении аккаунта
- Язык теперь загружается синхронно при старте приложения

---

## v1.0.2a (22.12.2025)

### Новые функции
- Реализована функция "Переслать" письмо
- Реализована функция "Переместить" письмо в другую папку
- Добавлена функция восстановления писем из корзины в исходную папку
- Полная локализация интерфейса (RU/EN)

### Исправления
- Исправлена работа Push-уведомлений (автоматический fallback на периодическую синхронизацию)
- Добавлен диалог подтверждения при удалении писем
- Кнопка удаления теперь корректно перемещает письма в корзину
- Убрана нерабочая кнопка "Архивировать"
- Исправлена бесконечная загрузка старых писем (добавлен таймаут 30 сек)
- Карточка "Избранные" теперь центрируется на главном экране
- Добавлена проверка интернет-соединения при добавлении аккаунта

---

## v1.0.1a (21.12.2025)

### Улучшения интерфейса
- Заменена статистика на время последней синхронизации
- Добавлена рекомендация дня для очистки папок (>1000 писем)
- Исправлено мгновенное обновление счётчиков папок при перемещении/удалении
- Исправлена отмена синхронизации при взаимодействии с UI
- Язык по умолчанию изменён на английский
- Добавлена кнопка переключения языка на экране добавления аккаунта
- Скрыты системные папки в диалоге перемещения
- В папке Спам кнопка "В спам" заменена на "Удалить окончательно"
- Улучшен диалог доната (убран СБП, улучшено выравнивание)
- Email и Telegram разработчика теперь кликабельные
- Улучшен UX полей ввода в ComposeScreen (автофокус)

---

## v1.0.0 (20.12.2025)

### Первый релиз
- Поддержка Exchange ActiveSync (EAS 2.5-14.1)
- Поддержка IMAP и POP3 (beta)
- Синхронизация папок и писем
- Отправка писем с вложениями
- Скачивание вложений
- Поиск по письмам
- Фильтры (непрочитанные, помеченные, с вложениями)
- Избранные письма
- Перемещение в спам/корзину
- Создание/удаление/переименование папок
- Несколько аккаунтов
- Фоновая синхронизация (WorkManager)
- Push-уведомления (Direct Push)
- Автозапуск после перезагрузки
- Тёмная тема
- Два языка (RU/EN)
