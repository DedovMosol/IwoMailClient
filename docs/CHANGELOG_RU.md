# История изменений

## v1.6.1 (09.02.2026) — Переименование пакета → "com.dedovmosol.iwomail", требуется переустановка

### Новое
- Rich Text редактор и HTML-подписи
- Инлайн-картинки — отправка, просмотр, ответ, пересылка, черновики (полный цикл через EWS CreateAttachment + cid:)
- Пользовательские папки — отдельный экран управления
- Проверка обновлений с push-уведомлением
- Клиентские сертификаты (.p12/.pfx) для mTLS, Certificate Pinning

### Улучшения
- Кликабельные ссылки, email и телефоны в теле письма
- Подсказки email при вводе с поиском по частичному совпадению
- Мультивыбор — массовое удаление в корзине, заметках, календаре
- Material3 DatePicker/TimePicker, единые скроллбары (Outlook-style)
- Календарь/задачи/заметки — обновлённые фильтры и поиск на всю ширину
- Полная локализация ошибок (EN/RU)

### Исправления
- Черновики — сохранение форматирования, инлайн-картинок и вложений на сервере
- Ответ/пересылка — корректные адреса, вложения и инлайн-картинки
- Синхронизация — передача статуса «прочитано» на сервер, защита от повторных синхронизаций, автовосстановление системных папок
- Удаление — batch-удаление, устранение «воскрешения» писем
- Блок «Сегодня» — корректный подсчёт всех писем за день
- Стабильность — обработка конфликтов markAsRead, утечки соединений, краш PushService (Android 12+), ANR SyncAlarmReceiver
- UI — защита от двойного нажатия, декодирование HTML entities

### Производительность
- Рефакторинг: 15 сервисов, 6 репозиториев
- Оптимизация N+1 запросов, кэширование, прекомпиляция regex
- PushService — экономия батареи, защита от китайских ROM

---

## v1.6.0 (08.01.2026)

### Новое
  - Экран приветствия (Onboarding) — слайды с возможностями приложения при первом запуске, выбор языка и анимаций
  - Переработанный виджет — новый дизайн с поиском, календарём, аккаунтами и счётчиками непрочитанных
  - Карточка статистики на главном экране — письма, события и задачи на сегодня
  - Экран обновлений — проверка обновлений с настройкой интервала   автопроверки
  - Экран "О приложении" — вся информация о приложении в одном месте
  - Экран "Синхронизация и очистка" — управление синхронизацией и автоочисткой для каждого аккаунта
  - Per-account настройки — ночной режим и игнорирование Battery Saver теперь настраиваются для каждого аккаунта отдельно
  - Офлайн-режим:
  - Баннер "Нет сети" — показывается в верхней части экрана когда нет интернета
  - Очередь отправки — письма без вложений сохраняются и отправляются автоматически при появлении сети
  - Кэширование тел писем — последние 7 писем в каждой папке загружаются в фоне для офлайн-доступа
  - Проверка сети перед синхронизацией — toast "Нет сети" вместо ожидания ошибки
  - Проверка сети перед скачиванием вложений

### Улучшения
  - Упрощённые экраны настроек — секции вынесены в отдельные экраны
  - Убраны секции "Советы" и "О программе" с главного экрана
  - Виджет обновляется после завершения синхронизации
  - Скроллбар в диалоге перемещения писем

### Исправления
  - Стабильная загрузка счётчиков календаря/заметок/задач при запуске
  - Счётчики не уменьшаются во время синхронизации
  - Исправлен краш при удалении писем из серверных папок
  - Центрирование иконки пустой папки
  - Цвета SelectionTopBar соответствуют теме

---

## v1.5.2 (07.01.2026)

### Новое
- App Shortcuts — быстрые действия при удержании иконки (Написать, Входящие, Поиск, Синхронизировать)
- Кнопка "Написать" на экране поиска

### Улучшения
- Имена отправителей берутся из контактов (приоритет), затем из истории переписки

### Исправления Exchange 2007
- Синхронизация задач — используется EWS вместо EAS (EAS возвращает пустой ответ)
- Создание задач — используется EWS для всех задач (EAS не работает на Exchange 2007)
- Удаление задач с сервера теперь работает корректно

### Исправления
- Дублирование задач/событий/заметок при создании на Exchange 2007
- Счётчики папок не обновлялись после первой синхронизации
- Дублирование описания в событиях и задачах

---

## v1.5.1 (05.01.2026)

### Новые функции
- **Отмена отправки** — 3 секунды на отмену после нажатия "Отправить"

### Улучшения
- **Смена аккаунта в письме** — при выборе другого отправителя автоматически подставляется его подпись и контакты
- **Обновление по архитектуре** — скачивается APK для вашей архитектуры (arm64, arm32, x86)
- **Прогресс-бар удаления** — перенесён вниз экрана, не перекрывает содержимое
- **Напоминания задач** — добавлено планирование напоминаний при создании и редактировании задач

### Исправления
- Исправлен повторный запуск ComposeScreen при повороте экрана после mailto:
- Исправлено отображение кнопок в диалоге "Поддержать разработчика" в альбомном режиме
- Исправлено сохранение черновика при смене отправителя
- Исправлен переход на экран авторизации после удаления последнего аккаунта

### Исправления багов v1.5.0
- Исправлена синхронизация по расписанию — интервал теперь применяется корректно
- Исправлено удаление событий календаря с сервера
- Исправлен ответ на приглашения — используется правильный аккаунт
- Исправлено дублирование участников в событиях календаря
- Исправлена отправка приглашений на митинги
- Исправлено дублирование текста в теле события при принятии приглашения
- Исправлено открытие письма из уведомления и переключение аккаунта
- Исправлена загрузка задач на главном экране

### Исправления Exchange 2007
- **Задачи с датами** — исправлено создание задач с датами на Exchange 2007:
  - Используется EWS вместо EAS для создания задач с датами
  - Срок выполнения (DueDate) и описание сохраняются на сервере
  - Дата начала (StartDate) сохраняется только локально (ограничение Exchange 2007)
  - Задачи без дат создаются через EAS как раньше
- **Создание событий календаря** — обновлён формат EWS запроса по официальной документации Microsoft
- **Митинги с участниками** — приглашения теперь отправляются через Exchange (не отдельным письмом)
- **Синхронизация задач** — исправлен парсинг WBXML (добавлен Code Page 9 для Tasks)
- **Тело задач/календаря** — добавлен BodyPreference в запросы синхронизации

### Примечание
⚠️ **Календарь и Задачи находятся в бета-режиме** — возможны ошибки и нестабильная работа

---

## v1.5.0 (03.01.2026)

### Новые функции
- **Отмена отправки** — 3 секунды на отмену после нажатия "Отправить" (зелёный прогресс-бар)

### Улучшения
- **Смена аккаунта в письме** — при выборе другого отправителя автоматически подставляется его подпись и контакты
- **Обновление по архитектуре** — скачивается APK для вашей архитектуры (arm64, arm32, x86)
- **Прогресс-бар удаления** — перенесён вниз экрана, не перекрывает содержимое

### Исправления
- Исправлен повторный запуск ComposeScreen при повороте экрана после mailto:
- Исправлено отображение кнопок в диалоге "Поддержать разработчика" в альбомном режиме
- Исправлено сохранение черновика при смене отправителя

---

## v1.4.2 (01.01.2026)

### Новые функции
- **Задачи** — синхронизация и управление личными задачами с сервера
  - Просмотр, создание, редактирование и удаление задач
  - Фильтры: все, активные, выполненные, важные, просроченные
  - Поиск по задачам
  - Отметка выполнения с синхронизацией на сервер
  - Приоритет и срок выполнения
  - Автоматическая синхронизация в фоне
  - Уведомления
  - Выбор даты и времени для начала и срока выполнения

### Улучшения
- **Оптимизация памяти** — репозитории на главном экране теперь кэшируются
- **Оптимизация сети** — кэширование ID папки задач (меньше HTTP запросов)
- **Оптимизация батареи** — синхронизация задач учитывает интервал (не при каждом запуске)
- **Редактирование черновиков** — исправлено сохранение изменений в черновиках с сервера

### Исправления
- Индикатор экономии батареи теперь обновляется при изменении режима
- Убран большой размер шрифта из настроек
- Исправлен badge черновиков на главном экране (показывался даже без черновиков)

---

## v1.4.1 (31.12.2025)

### Новые функции
- **Серверные черновики** — черновики теперь синхронизируются с сервером Exchange через EWS (ранее хранились только локально)
  - Созданный черновик сохраняется на сервер
  - Синхронизация черновиков с сервера
  - Редактирование черновика обновляет на сервере
- **Высокий приоритет при отправке** — возможность отметить письмо как важное при отправке (получатель увидит красный восклицательный знак)

### Улучшения
- **Компактные диалоги** — диалоги заметок и событий календаря теперь компактные, размер по содержимому
- **Динамическая высота карточек папок** — текст больше не обрезается на маленьких экранах
- **Оптимизация Regex** — предкомпилированные и кэшированные regex паттерны во всех ключевых файлах

### Исправления
- **Удаление черновиков** — черновики удаляются сразу, без перемещения в корзину
- **Смешанное удаление** — корректная обработка удаления писем из разных папок одновременно
- **Отображение папки Черновики** — исправлен краш при удалении писем, черновики теперь используют стандартный Flow вместо ручной загрузки
- **Скрытая копия (BCC)** — исправлена отправка писем со скрытой копией (ранее BCC не работал)
- **Локализация цитат** — текст "Исходное сообщение", "От", "Дата", "Тема" в ответах и пересылках теперь локализуется
- **Синхронизация черновиков** — полная ресинхронизация при каждом обновлении, удаления из Outlook теперь отображаются
- **Синхронизация календаря** — исправлено мерцание UI и перепланирование всех напоминаний при каждой синхронизации
- **Синхронизация заметок** — исправлено мерцание UI при синхронизации
- **Синхронизация контактов** — исправлено мерцание UI при синхронизации
- **Локализация** — все захардкоженные строки локализованы
- **Краш DatePicker** — исправлен краш при выборе даты планирования
- **Краш WBXML парсера** — исправлен краш при кодировании нулевого значения
- **SSL с самоподписанными сертификатами** — исправлена ошибка согласования политики безопасности при acceptAllCerts
- **EWS аутентификация** — добавлен fallback на Basic auth для серверов не поддерживающих NTLM

---

## v1.4.0 (31.12.2025)

### Новые функции
- **Создание событий календаря** — возможность создавать события прямо из приложения с синхронизацией на сервер Exchange
- **Редактирование событий** — изменение названия, времени, места, описания, напоминания и статуса занятости
- **Удаление событий** — удаление событий с сервера Exchange
- **Напоминания о событиях** — push-уведомления за указанное время до начала события
- **Создание заметок** — возможность создавать заметки с синхронизацией на сервер
- **Редактирование заметок** — изменение заголовка и текста заметки
- **Удаление заметок** — удаление заметок с сервера

### Улучшения
- **Автоскролл** — список прокручивается вверх после создания заметки или события
- **Оптимизация производительности** — предкомпилированные regex паттерны

### Исправления
- **Сохранение черновиков** — текст письма теперь сохраняется корректно
- **Утечка памяти** — исправлена утечка CoroutineScope в MainScreen
- **Оптимизация батареи** — увеличен таймаут перезапуска PushService с 5 до 30 сек для предотвращения агрессивного цикла перезапусков

### Технические детали
- Календарь: EAS Sync Add/Change/Delete для всех версий Exchange (2007+)
- Заметки Exchange 2010+: EAS Sync Add/Change/Delete
- Заметки Exchange 2007: EWS CreateItem/UpdateItem/DeleteItem с NTLMv2
- Напоминания: AlarmManager с setExactAndAllowWhileIdle для точного времени

---

## v1.3.2 (30.12.2025)

### Новые функции
- **Фильтр "Важные"** — новый фильтр для писем с высоким приоритетом (Importance = High)
- **Иконка приоритета** — письма с высоким приоритетом отмечаются красным восклицательным знаком в списке

### Исправления
- **Синхронизация удалений** — письма, удалённые или перемещённые на сервере (Outlook), теперь удаляются из локальной БД при синхронизации
- **Загрузка тела письма** — добавлен fallback на plain text (Type=1) если HTML не вернул результат
- **Первичная синхронизация для нескольких аккаунтов** — теперь каждый аккаунт синхронизируется отдельно, уведомление показывается для каждого
- **Параллельная синхронизация папок** — папки синхронизируются параллельно, а не последовательно
- **Автоскролл при синхронизации** — список писем автоматически прокручивается вверх при появлении новых писем во время синхронизации
- **Вложения при повороте экрана** — вложения больше не пропадают при повороте экрана в просмотре письма
- **Декодирование quoted-printable** — исправлено декодирование кириллицы в письмах с quoted-printable кодировкой
- **Отмена синхронизации при смене аккаунта** — при быстром переключении аккаунтов предыдущая синхронизация корректно отменяется
- **Timeout загрузки тела письма** — добавлен общий timeout 25 сек на тройной fallback (MIME → HTML → Plain)
- **Удаление писем при ошибке сервера** — если сервер не отвечает, письма удаляются локально

### Улучшения
- **Заметки для Exchange 2007** — добавлена синхронизация заметок через EWS с NTLMv2 для серверов без поддержки EAS 14.1+
- **Уведомление о локальных черновиках** — в папке Черновики показывается информация что они хранятся локально

---

## v1.3.1 (29.12.2025)

### Исправления
- **Утечка памяти Bitmap** — картинки в описании событий теперь освобождаются при выходе из экрана
- **Незакрытые HTTP соединения** — соединения при загрузке картинок теперь корректно закрываются
- **Оптимизация Regex** — паттерны для парсинга ссылок компилируются один раз, а не при каждом вызове
- **SoundPlayer race condition** — добавлена синхронизация для предотвращения конфликтов потоков
- **Очистка кэша при удалении аккаунта** — EasClient и heartbeat теперь очищаются при удалении аккаунта
- **Сохранение heartbeat** — адаптивный heartbeat сохраняется между перезапусками PushService
- **Удаление локальных контактов** — исправлено удаление контактов (список теперь обновляется)
- **Аватары в Отправленных** — теперь показывается первая буква/цифра имени получателя
- **Дублирование email отправителя** — если имя совпадает с email, показывается только email без дублирования
- **Массовое удаление контактов** — исправлено удаление нескольких контактов одновременно
- **Первичная синхронизация** — календарь, заметки и контакты теперь синхронизируются при первом запуске
- **Pull-to-refresh в пустой папке** — анимированный конвертик теперь отображается по центру вверху
- **Обновление списка писем** — исправлено автоматическое обновление списка при фоновой синхронизации

### Улучшения
- **Копирование контактов из организации** — добавлена кнопка массового копирования выбранных контактов в личные
- **Текст настройки** — уточнён текст "Игнорировать режим экономии аккумулятора при синхронизации"
- **Кликабельный получатель** — поле "Кому" в письме теперь кликабельное, открывает написание письма с заполненным адресом
- **Иконка FAB в Отправленных** — изменена с карандаша на иконку письма
- **Сброс раскрытых секций** — секции "Советы" и "О программе" сворачиваются при переходе в папку
- **Боковое меню** — Контакты, Заметки и Календарь перенесены в боковое меню под Избранное
- **Обновление списка в реальном времени** — письма в папке обновляются автоматически во время фоновой синхронизации
- **Кликабельные email в календаре** — email организатора и участников события кликабельные, открывают написание письма
- **Кликабельные ссылки в location** — если место события содержит URL, он кликабельный и открывается в браузере
- **Диалог контакта** — убран крестик закрытия, диалог закрывается тапом по пустому месту

---

## v1.3.0 (29.12.2025)

### Новые функции
- **Заметки Exchange** — синхронизация и просмотр заметок из папки Notes на сервере Exchange
- **Календарь Exchange** — синхронизация и просмотр событий календаря с двумя режимами отображения:
  - Agenda — список событий, сгруппированных по датам
  - Месяц — сетка календаря с точками на днях с событиями
  - Год — при клике на заголовок месяца открывается вид со всеми 12 месяцами
- **Настройки синхронизации заметок и календаря** — в настройках аккаунта можно выбрать интервал: отключено, ежедневно, еженедельно, раз в 2 недели, ежемесячно
- **Автоматическая синхронизация** — заметки и календарь синхронизируются в фоне вместе с контактами
- **Множественный выбор контактов**
- **Избранные контакты** — возможность отмечать контакты звёздочкой и фильтровать по избранным
- Карточки "Заметки" и "Календарь" на главном экране
- Поиск по заметкам и событиям
- Детальный просмотр событий (время, место, организатор, участники)
- Счётчики контактов в табах "Личные" и "Организация"
- Обновлён раздел "О программе" — добавлены контакты, заметки и календарь

### Улучшения
- **Год в дате событий** — заголовки групп показывают год (пятница, 25 декабря 2020)
- **Отметка прошедших событий** — зелёная галочка и приглушённые цвета для завершённых событий
- **Кликабельные ссылки в событиях** — URL в описании событий кликабельные
- **Картинки в событиях** — изображения из описания событий загружаются и отображаются
- **Дни с событиями выделены** — в годовом виде дни с событиями показаны синим цветом
- **Улучшен скролл писем** — WebView больше не блокирует скролл родительского контейнера
- **Inline картинки** — не показываются в списке вложений, отображаются в теле письма
- **Устранение багов с цветовой палитрой аватаров** — во всех местах сделано 32 цвета

---

## v1.2.0 (29.12.2025)

### Новые функции
- **Ребрендинг** — приложение переименовано в "iwo Mail Client"
- **Фоновая синхронизация GAL контактов** — контакты из адресной книги организации теперь загружаются автоматически в фоне и сохраняются в локальную БД (как письма)
- **Настройка интервала синхронизации контактов** — в настройках аккаунта можно выбрать: отключено, каждый день, раз в неделю, раз в 2 недели, раз в месяц (по умолчанию — каждый день)
- **Ручная синхронизация контактов** — кнопка "Синхронизировать" на вкладке "Организация" в контактах
- **Несколько подписей** — до 5 подписей для каждого аккаунта с выбором при написании письма
- **Автоматическая очистка** — индивидуальные настройки для каждого аккаунта: корзина, черновики, спам (никогда, 3, 7, 14, 30, 60 дней)
- **Выбор контактов при написании письма** — кнопка выбора контактов рядом с полями Кому/Копия/Скрытая с двумя вкладками (Личные и Организация), поиском и множественным выбором

### Улучшения
- **Оптимизация звуков** — конвертация MP3→OGG (~45 КБ экономии)
- **Папка Отправленные** — теперь показывает получателя с префиксом "Кому:" вместо отправителя
- **Кнопка "Написать ещё"** — в папке Отправленные вместо "Ответить" для продолжения переписки
- **Очистка HTML в цитатах** — при ответе и пересылке HTML теги удаляются, показывается чистый текст
- **Совместимость с Exchange 2007** — улучшен формат XML запросов для EAS 12.x (BodyPreference с TruncationSize)
- **Загрузка GAL по буквам** — для серверов не поддерживающих wildcard "*" контакты загружаются по буквам алфавита (A-Z, А-Я)
- **Настройки аккаунта** — вынесены на отдельный экран (как персонализация интерфейса)
- **Исправлены тексты диалогов удаления** — для черновиков и удалённых показывается "будет удалено окончательно", для остальных папок "будет перемещено в удалённые"
- **Локализация ошибок авторизации** — ошибки 401, timeout и другие теперь показываются на выбранном языке
- **Исправлен цвет аватаров** — теперь используется выбранный цвет аккаунта
- Исправлено обновление списка черновиков после удаления
- Предупреждение при удалении сертификата сервера
- Обновлены ссылки на GitHub репозиторий
- Поля получателей теперь поддерживают несколько строк (до 3) для удобного отображения множества адресов

### Исправления
- **Контакты в диалоге выбора** — теперь показываются синхронизированные контакты из БД
- **Повторная загрузка GAL** — контакты больше не перезагружаются при каждом заходе во вкладку "Организация"
- **Исправлено дублирование получателя** — в просмотре письма теперь не дублируется имя и email
- Уведомление "Ожидание писем" при режиме "По расписанию"
- Ответ на письмо из Отправленных теперь заполняет поле "Кому" получателем, а не отправителем

---

## v1.1.2 (28.12.2025)

### Новые функции
- Экран персонализации интерфейса

### Исправления
- Экспорт контактов (FileProvider)
- Тестовое письмо при верификации удаляется автоматически
- Кнопки в диалогах — вертикальная компоновка
- Папка Contacts скрыта из списка
- Поиск GAL при возврате на экран контактов
- Свайп назад в написании письма показывает диалог сохранения
- Сохранение фокуса при повороте экрана
- Счётчик черновиков обновляется сразу после сохранения
- Удаление локальных черновиков теперь работает корректно
- Диалог сохранения черновика сохраняется при повороте экрана
- Синхронизация не прерывается при навигации

### Улучшения
- Диалоги — компактный дизайн, анимации
- Время синхронизации — формат дата+время, только после завершения
- Обновлена секция "Советы"
- Аватар пользователя использует цвет аккаунта из настроек
- Черновики сохраняются локально и удаляются сразу (не в корзину)
- Папка Черновики не синхронизируется с сервером
- Диалог сохранения черновика в стиле Material Design
---

## v1.1.1 (27.12.2025)

### Исправления
- **Порядок кнопок буфера обмена** — Вырезать → Копировать → Вставить
- **Меню контакта** — добавлены "Редактировать" и "Удалить" в меню трёх точек
- **Кнопки в диалоге контакта** — "Отмена" и "Сохранить" разнесены в разные стороны
- **Синхронизация при повороте экрана** — синхронизация больше не прерывается при смене ориентации
- **Диалог просмотра контакта** — переделан дизайн, кнопки действий внизу
- **Очистка корзины при навигации** — удаление продолжается даже при выходе из папки корзины
- **Компактный диалог редактирования** — поля сгруппированы в ряды
- **Текст сертификатов** — добавлено предупреждение "(опаснее)"
- **Уведомления при первом запуске** — не показываются для старых писем
- **Порядок папок на главном экране** — Входящие/Отправленные, Черновики/Удалённые, Избранные/Контакты

### Улучшения
- **Текст настройки Battery Saver** — переформулировано на "Частая синхронизация"
- **Текст про уведомление Push** — уточнено что только в режиме Push
- **Карточка Контакты** — добавлена на главный экран (голубая)

---

## v1.1.0 (27.12.2025)

### Новые функции
- **Группы контактов** — организация контактов по папкам:
  - Создание, переименование и удаление групп
  - Перемещение контактов между группами
  - Фильтрация контактов по группам (чипы)
  - Просмотр контактов без группы
- **Режим экономии батареи** — приложение автоматически определяет когда Android включает режим экономии:
  - Увеличивает интервал синхронизации до 60 минут
  - Показывает индикатор на главном экране
  - Настройка "Игнорировать режим экономии" для тех кому важна почта

### Исправления
- **Очистка корзины** — теперь показывается реальный прогресс удаления (X / Y писем), а не фейковый таймер. Обратный отсчёт 3 сек для отмены, затем реальное удаление с прогрессом.
- **Цвет аватара пользователя** — аватар в поиске и настройках теперь меняется вместе с цветовой темой приложения

### Изменения
- **Exchange 2003 не поддерживается** — убрана поддержка EAS 2.5 (Exchange 2003). Поддерживаются версии EAS 12.0-14.1 (Exchange 2007+).
---

## v1.0.9 (27.12.2025)

### Новые функции
- **Контакты** — полноценная система управления контактами:
  - Личные контакты с добавлением, редактированием и удалением
  - Поиск по корпоративной адресной книге (GAL)
  - Экспорт контактов в vCard (.vcf) и CSV
  - Импорт контактов из vCard и CSV
  - Алфавитная группировка и поиск
  - Добавление GAL контактов в личные
  - Интеграция с написанием писем
- **Автодополнение адресов** — при вводе email в поле "Кому" показываются подсказки из:
  - Локальных контактов
  - Истории переписки
  - Корпоративной адресной книги (GAL)

### Улучшения
- **Фоновая синхронизация** — все папки синхронизируются в фоне при запуске, при входе в папку данные показываются мгновенно из кэша
- **Стилизованные диалоги** — все диалоги теперь в едином стиле с градиентом
- **Индикатор сертификата** — в настройках аккаунта показывается если используется сертификат сервера
- **Управление сертификатом** — при тапе на "Сертификат сервера" можно:
  - Просмотреть информацию (имя файла, размер)
  - Экспортировать (выбор места и имени файла)
  - Заменить на другой
  - Удалить
- **Ссылка на разработчика** — "DedovMosol" в настройках теперь кликабельна и ведёт на GitHub

### Исправления
- **Прогрессбар удаления** — исправлено отображение прогрессбара при очистке корзины
- **Выбор сертификата** — теперь можно выбрать только файлы сертификатов (.cer, .crt, .pem, .der, .p12, .pfx, .p7b, .p7c)
- **Удаление аккаунта** — при удалении аккаунта теперь полностью очищаются локальные данные (файлы вложений, сертификат)

---

## v1.0.8 (27.12.2025)

### Новые функции
- **Отложенное удаление корзины** — при очистке корзины показывается индикатор прогресса с кнопкой отмены. Время зависит от количества писем (100мс на письмо, 2-8 сек). Пока прогресс идёт — письма не удаляются, можно отменить.
- **Автоочистка корзины** — автоматическое удаление старых писем из корзины через 3/5/7/14/30 дней (по умолчанию 30 дней)
- **Настройка анимаций** — переключение в настройках включения/отключения анимаций интерфейса (по умолчанию анимации включены)
- **Расширенные анимации карточек папок** — пульсация иконок, лёгкое покачивание, анимация масштаба при нажатии
- **Выбор сертификата сервера** — возможность указать файл сертификата для корпоративных серверов с самоподписанными сертификатами
- **Звук удаления** — звуковое уведомление при удалении писем и папок

### Улучшения интерфейса
- **Кнопка "Ознакомиться с развитием программы"** — анимированная кнопка со ссылкой на changelog на GitHub
- **Ссылка на политику конфиденциальности** — добавлена в настройках в секции "О приложении"
- **Галочки отчётов в меню** — "Запросить отчёт о прочтении/доставке" перенесены в выпадающее меню при написании письма
- **Анимация появления карточек** — staggered анимация при загрузке главного экрана
- **Пульсация badge непрочитанных** — анимированный счётчик непрочитанных писем
- **Индикатор прогресса удаления** — появляется вверху экрана поверх всего контента

### Исправления
- **certificatePath во всех клиентах** — сертификат теперь корректно передаётся при отправке писем, скачивании вложений и в фоновых задачах
- **Очистка кэша EasClient при обновлении аккаунта** — изменения настроек аккаунта применяются сразу
- **Загрузка certificatePath при редактировании** — путь к сертификату сохраняется при редактировании аккаунта
- **Сохранение certificatePath в savedData** — сертификат не сбрасывается при возврате с ошибкой верификации
- **Уведомления для нескольких аккаунтов** — теперь каждый аккаунт показывает отдельное уведомление с указанием email

### Локализация
- Добавлены строки для анимаций, цветовых тем, дней недели, отложенного удаления и автоочистки корзины

---

## v1.0.7 (27.12.2025)

### Новые функции
- **Диалог несовпадения email** — при верификации Exchange аккаунта показывается информативный диалог вместо ошибки
- **Цветовые темы** — выбор из 7 цветовых тем: фиолетовая, синяя, красная, жёлтая, оранжевая, зелёная, розовая
- **Темы по дням недели** — возможность назначить разные цвета для каждого дня недели
- **Анимированный логотип** — конвертик в секции "О приложении" с пульсацией и покачиванием
- **Группировка настроек** — настройки разделены на секции: Внешний вид, Синхронизация, О приложении
- **Подпись для аккаунта** — возможность задать подпись для каждого аккаунта, автоматически подставляется при написании письма
- **Звуки отправки и получения** — звуковое уведомление при отправке письма и получении новых писем

### Улучшения интерфейса
- **Исправлен перенос слов** — в диалоге доната слова больше не разрываются по буквам при большом шрифте
- **Обновлены советы** — секция "Полезно знать" сокращена до 4 ключевых пунктов
- **Pull-to-refresh с конвертиком** — потяните список писем вниз для обновления, анимированный конвертик вместо стандартного индикатора
- **Предпросмотр вложений** — если письмо содержит скачанную картинку, миниатюра показывается в списке писем

### Исправления
- **Исправлен адрес отправителя в MDN/DSN** — отчёты о прочтении и доставке теперь отправляются на правильный email
- **Исправлены поля ввода времени** — в диалоге планирования отправки теперь можно нормально редактировать часы/минуты/секунды
- **Автоактивация нового аккаунта** — при добавлении второго аккаунта он автоматически становится активным
- **Сохранение настроек при ошибке 401** — при ошибке авторизации сохраняются email, сервер, цвет, галочка сертификатов; сбрасываются только домен, логин и пароль

### Технические улучшения
- **LocalColorTheme** — CompositionLocal для динамической смены цветовой темы
- **Градиенты TopAppBar и FAB** — теперь используют цвета из выбранной темы

### Безопасность
- **Отключён ADB бэкап** — `allowBackup="false"` предотвращает извлечение данных приложения через ADB 

---

## v1.0.6c (26.12.2025)

### Новые функции
- **Верификация email при добавлении Exchange аккаунта** — проверка что введённый email соответствует реальному email на сервере
- **Экран "Проверка учётной записи"** — анимированный экран верификации как в Outlook
- **Запрос отчёта о прочтении (MDN)** — чекбокс при отправке письма для запроса уведомления о прочтении
- **Запрос отчёта о доставке (DSN)** — чекбокс для подтверждения доставки письма на сервер получателя
- **Настройка размера шрифта** — выбор маленький/средний/большой в настройках приложения
- **Индивидуальные настройки синхронизации** — каждый аккаунт имеет свой режим и интервал
- **Настройки в карточке аккаунта** — режим (Push/Scheduled) и интервал прямо в UI

### Оптимизация батареи
- **Выбор режима синхронизации** — для Exchange аккаунтов можно выбрать Push (мгновенные уведомления) или По расписанию (экономия батареи)
- **Ночной режим экономии** — с 23:00 до 7:00 синхронизация каждые 60 минут вместо настроенного интервала
- **Адаптивный heartbeat** — автоматическое увеличение интервала Ping с 5 до 15 минут при стабильной работе
- **Умная остановка без сети** — PushService приостанавливается когда нет интернета, не тратит батарею
- **Debounce синхронизации** — защита от двойных запросов синхронизации
- **Умная логика синхронизации** — автоотключение периодической синхронизации для Push аккаунтов

### Исправления багов
- **Исправлена вибрация** — при выделении писем вибрация работает корректно
- **Исправлена подсветка в поиске** — подсветка найденных букв работает на всех устройствах
- **Исправлен скролл при "Выбрать всё"** — автоматическая прокрутка к началу списка
- **Исправлены уведомления** — фиксированные ID, не создают спам
- **Исправлен язык по умолчанию** — теперь русский для новых установок

### Технические улучшения
- **VerificationScreen** — новый экран верификации email с анимацией
- **fetchOneEmailForVerification** — метод получения 1 письма для быстрой верификации (WindowSize=1)
- **NetworkCallback** — мгновенное возобновление работы при появлении сети
- **База данных v9** — добавлено поле syncIntervalMinutes в AccountEntity
- **SyncWorker.getMinSyncInterval()** — централизованная функция получения интервала
- **SyncMode.getDisplayName()** — локализация режимов синхронизации
- **ScaledAlertDialog** — все диалоги теперь корректно масштабируют шрифт согласно настройкам
- **Очистка кода** — удалены неиспользуемые методы из SettingsRepository

---

## v1.0.5c (25.12.2025)

### Исправления уведомлений
- Исправлены уведомления на заблокированном экране — добавлен `VISIBILITY_PUBLIC`
- Каналы уведомлений теперь пересоздаются при запуске для применения новых настроек
- Добавлена категория `CATEGORY_EMAIL` для правильной обработки системой
- Канал новых писем теперь имеет `lockscreenVisibility = PUBLIC`

### Исправления перемещения писем
- Исправлен баг восстановления из корзины — теперь письмо возвращается в папку, из которой было удалено
- `originalFolderId` корректно обновляется при перемещении между папками

### Исправления навигации
- Исправлен баг открытия письма из уведомления после смахивания приложения
- Добавлена проверка существования письма перед открытием
- Если письмо не найдено — открываются Входящие с фильтром "Непрочитанные"

### Улучшения совместимости
- Улучшена совместимость TLS на разных устройствах — убран устаревший SSLv3
- Добавлена поддержка TLSv1.3
- Улучшена обработка ошибок SSL/TLS — fallback на дефолты OkHttp
- Добавлены таймауты на синхронизацию (60 сек общий, 30 сек на папку)

---

## v1.0.5b (25.12.2025)

### Модернизация интерфейса
- Градиентные TopAppBar на всех экранах (фиолетово-синий градиент)
- Карточки папок в едином стиле с яркими градиентами
- Gmail-style цвета аватаров для отправителей писем
- Пульсирующая анимация кнопки "Поддержать разработчика"
- Тактильная обратная связь (вибрация) при выделении писем
- Добавлена секция "Советы" с информацией о бета-функциях
- Функция очистки корзины с диалогом подтверждения

### Улучшения синхронизации
- Улучшена надёжность фоновой синхронизации (AlarmManager fallback)
- SyncAlarmReceiver теперь синхронизирует напрямую, не полагаясь только на WorkManager
- Foreground notification автоматически переводится при смене языка

### Исправления
- Исправлен баг с ложным переходом на экран настройки при запуске
- Улучшена логика автосинхронизации при старте приложения
- При открытии письма из уведомления кнопка "назад" ведёт во Входящие
- Состояние раскрытых секций сохраняется при синхронизации

---

## v1.0.4b (25.12.2025)

### Оптимизация производительности и памяти
- SettingsRepository теперь singleton — устранено создание множества экземпляров
- EasClient кэшируется для каждого аккаунта — экономия ресурсов при повторных запросах
- Исправлена утечка памяти в SyncAlarmReceiver — локальный coroutine scope с cancel() в finally
- Убрано дублирование синхронизации когда Direct Push не поддерживается сервером
- Убраны все Log.d() вызовы для production сборки — уменьшен размер APK
- Оптимизированы ProGuard правила для R8 минификации

### Улучшения интерфейса
- Улучшена логика диалога "Переместить": из системных папок показываются только пользовательские, из пользовательских — все папки
- Исправлен краш при открытии письма из уведомления на заблокированном экране
- IMAP и POP3 помечены как "beta" в интерфейсе добавления аккаунта

---

## v1.0.3c (24.12.2025)

### Критические исправления
- Исправлена критическая проблема с уведомлениями — теперь уведомления приходят для всех новых писем
- Исправлена навигация из foreground notification — теперь открывает главный экран
- Улучшена логика определения новых писем — используется время последней проверки
- Добавлен SyncAlarmReceiver для надёжной синхронизации на Xiaomi/MIUI

---

## v1.0.3b (24.12.2025)

### Улучшения уведомлений
- Улучшены уведомления о новых письмах — теперь показывают отправителя и тему
- При клике на уведомление с одним письмом — открывается это письмо напрямую
- Добавлена локализация специальных папок Exchange (Tasks, Calendar, Contacts)
- Добавлен запрос разрешений при первом запуске (батарея, точные alarm'ы)
- Улучшена надёжность фоновой синхронизации на Xiaomi/MIUI (AlarmManager fallback)
- Foreground notification теперь локализуется по настройкам приложения

---

## v1.0.3a (23.12.2025)

### Локализация
- Исправлена локализация интерфейса — все строки корректно переводятся
- Исправлены захардкоженные русские строки в ComposeScreen, SearchScreen, EmailListScreen
- Названия системных папок теперь локализуются (Inbox/Входящие, Sent/Отправленные и т.д.)
- Исправлен краш при первом добавлении аккаунта
- Язык теперь загружается синхронно при старте приложения

---

## v1.0.2a (22.12.2025)

### Новые функции
- Реализована функция "Переслать" письмо
- Реализована функция "Переместить" письмо в другую папку
- Добавлена функция восстановления писем из корзины в исходную папку
- Полная локализация интерфейса (RU/EN)

### Исправления
- Исправлена работа Push-уведомлений (автоматический fallback на периодическую синхронизацию)
- Добавлен диалог подтверждения при удалении писем
- Кнопка удаления теперь корректно перемещает письма в корзину
- Убрана нерабочая кнопка "Архивировать"
- Исправлена бесконечная загрузка старых писем (добавлен таймаут 30 сек)
- Карточка "Избранные" теперь центрируется на главном экране
- Добавлена проверка интернет-соединения при добавлении аккаунта

---

## v1.0.1a (21.12.2025)

### Улучшения интерфейса
- Заменена статистика на время последней синхронизации
- Добавлена рекомендация дня для очистки папок (>1000 писем)
- Исправлено мгновенное обновление счётчиков папок при перемещении/удалении
- Исправлена отмена синхронизации при взаимодействии с UI
- Язык по умолчанию изменён на английский
- Добавлена кнопка переключения языка на экране добавления аккаунта
- Скрыты системные папки в диалоге перемещения
- В папке Спам кнопка "В спам" заменена на "Удалить окончательно"
- Улучшен диалог доната (убран СБП, улучшено выравнивание)
- Email и Telegram разработчика теперь кликабельные
- Улучшен UX полей ввода в ComposeScreen (автофокус)

---

## v1.0.0 (20.12.2025)

### Первый релиз
- Поддержка Exchange ActiveSync (EAS 2.5-14.1)
- Поддержка IMAP и POP3 (beta)
- Синхронизация папок и писем
- Отправка писем с вложениями
- Скачивание вложений
- Поиск по письмам
- Фильтры (непрочитанные, помеченные, с вложениями)
- Избранные письма
- Перемещение в спам/корзину
- Создание/удаление/переименование папок
- Несколько аккаунтов
- Фоновая синхронизация (WorkManager)
- Push-уведомления (Direct Push)
- Автозапуск после перезагрузки
- Тёмная тема
- Два языка (RU/EN)

